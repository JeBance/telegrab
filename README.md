# ü§ñ Telegrab ‚Äî –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π Telegram

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://python.org)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104%2B-green.svg)](https://fastapi.tiangolo.com)
[![Telethon](https://img.shields.io/badge/Telethon-1.34%2B-green.svg)](https://docs.telethon.dev)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-ready-blue.svg)](https://docker.com)

**Telegrab** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Telegram-—á–∞—Ç–æ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º REST API, WebSocket –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –≥–æ—Ç–æ–≤—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –¥–ª—è production-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è.

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–Ω–∞-—Å–µ—Ä–≤–µ—Ä)
- [–ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π Telegram](#-–ø–æ–ª—É—á–µ–Ω–∏–µ-api-–∫–ª—é—á–µ–π-telegram)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](#-–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- [API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [WebSocket](#-websocket)
- [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [Production —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-production-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ](#-–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç](#-–≤–∫–ª–∞–¥-–≤-–ø—Ä–æ–µ–∫—Ç)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | –ó–∞—â–∏—Ç–∞ API –∫–ª—é—á–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key` |
| üîÑ **WebSocket** | Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| üìö **–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏** | –ü–æ—ç—Ç–∞–ø–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–æ–≤ Telegram API |
| üîç **–ü–æ–∏—Å–∫** | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º |
| üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Ç–∞–º –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º |
| üöÄ **Production ready** | Docker, systemd, nginx ‚Äî –≤—Å—ë –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ |
| üåê **REST API** | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π HTTP API —Å –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π (Swagger) |
| üé® **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å —Ç–µ–º–Ω–æ–π —Ç–µ–º–æ–π |
| ü§ñ **UserBot —Ä–µ–∂–∏–º** | –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–≤ |
| ‚ö° **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** | –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Å rate limiting |
| üì• **–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π |
| üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ GitHub (systemd timer + webhook) |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.8+** (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
- **Docker + Docker Compose** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)
- **–ê–∫–∫–∞—É–Ω—Ç Telegram** —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- **API –∫–ª—é—á–∏ Telegram** (API_ID –∏ API_HASH)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/JeBance/telegrab.git
cd telegrab

# 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ .env (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ API_ID, API_HASH, PHONE)
nano .env

# 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f telegrab

# 6. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ .env
nano .env

# 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python telegrab.py

# 5. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–ø—Ä–æ—Å–∏—Ç –∫–æ–¥ –∏–∑ SMS
#    –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª .session
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
git clone https://github.com/JeBance/telegrab.git
cd telegrab
chmod +x install.sh
./install.sh

# 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nano /opt/telegrab/.env

# 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl start telegrab
sudo systemctl enable telegrab

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status telegrab

# 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
journalctl -u telegrab -f
```

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–ø–æ–¥—Ä–æ–±–Ω–æ)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (Ubuntu 22.04 LTS)

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER
newgrp docker

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo apt install -y docker-compose

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
docker --version
docker-compose --version
```

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Telegrab

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /opt/telegrab
sudo chown $USER:$USER /opt/telegrab
cd /opt/telegrab

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/JeBance/telegrab.git .

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano .env
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

```ini
# === –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ ===
# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ https://my.telegram.org
API_ID=12345678
API_HASH=abcdef1234567890abcdef1234567890
PHONE=+79991234567

# === –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ ===
# API –∫–ª—é—á (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π)
# API_KEY=tg_your_secret_key_here

# –ü–æ—Ä—Ç API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000)
API_PORT=3000

# –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
AUTO_LOAD_HISTORY=true
HISTORY_LIMIT_PER_CHAT=200
MAX_CHATS_TO_LOAD=20

# –ê–≤—Ç–æ–¥–æ–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
AUTO_LOAD_MISSED=true
MISSED_LIMIT_PER_CHAT=500
MISSED_DAYS_LIMIT=7

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ (–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Telegram)
REQUESTS_PER_SECOND=1
MESSAGES_PER_REQUEST=100
```

### –ó–∞–ø—É—Å–∫

```bash
# –ß–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

---

## üîë –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π Telegram

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ https://my.telegram.org
   - –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Å–≤–æ–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞

2. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   - –í—ã–±–µ—Ä–∏—Ç–µ **"API Development Tools"**
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
     - **App title**: –õ—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Telegrab`)
     - **Short name**: –ö–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `telegrab`)
     - **URL**: –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º
     - **Platform**: –í—ã–±–µ—Ä–∏—Ç–µ `Desktop`

3. **–ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏:**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **API ID** (—á–∏—Å–ª–æ)
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **API Hash** (32 —Å–∏–º–≤–æ–ª–∞)
   - –í—Å—Ç–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–∞–π–ª `.env`

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ API –∫–ª—é—á–∏ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –∏ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------|
| `API_ID` | ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram | `12345678` |
| `API_HASH` | –•—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram | `abcdef1234567890...` |
| `PHONE` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | `+79991234567` |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `API_KEY` | –∞–≤—Ç–æ | –ö–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ API |
| `API_PORT` | `3000` | –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ |
| `TELEGRAM_MODE` | `production` | –†–µ–∂–∏–º Telegram: `test` –∏–ª–∏ `production` |

### üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä–∞ Telegram:

```ini
TELEGRAM_MODE=test
```

**–í–∞–∂–Ω–æ:**
- –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã Telegram **–Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç** —Å production —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä –Ω–∞ https://my.telegram.org/test
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏—á–Ω—ã–π –Ω–æ–º–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–µ—Å—Å–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∏ production –∞–∫–∫–∞—É–Ω—Ç–æ–≤ **–Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã**

**–°–µ—Ä–≤–µ—Ä–∞ (–Ω–∞—á–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è):**
| –†–µ–∂–∏–º | DC ID | –°–µ—Ä–≤–µ—Ä | –ü–æ—Ä—Ç |
|-------|-------|--------|------|
| **Test** | 2 | 149.154.167.40 | 443 |
| **Production** | 2 | 149.154.167.50 | 443 |

> üí° **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telethon –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—Å–µ—Ö DC —Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ `help.getConfig`. –£–∫–∞–∑–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `AUTO_LOAD_HISTORY` | `true` | –ó–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| `HISTORY_LIMIT_PER_CHAT` | `200` | –°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —á–∞—Ç –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑ |
| `MAX_CHATS_TO_LOAD` | `20` | –ú–∞–∫—Å–∏–º—É–º —á–∞—Ç–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `AUTO_LOAD_MISSED` | `true` | –î–æ–≥—Ä—É–∂–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| `MISSED_LIMIT_PER_CHAT` | `500` | –ú–∞–∫—Å–∏–º—É–º –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –Ω–∞ —á–∞—Ç |
| `MISSED_DAYS_LIMIT` | `7` | –ú–∞–∫—Å–∏–º—É–º –¥–Ω–µ–π –¥–ª—è –¥–æ–≥—Ä—É–∑–∫–∏ |

### Rate limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `REQUESTS_PER_SECOND` | `1` | –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API –≤ —Å–µ–∫—É–Ω–¥—É |
| `MESSAGES_PER_REQUEST` | `100` | –°–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å |

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è rate limiting ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Telegram!

---

## üåê API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL

```
http://localhost:3000
```

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ nginx —Å HTTPS:
```
https://your-domain.com
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ endpoints (–∫—Ä–æ–º–µ `/`, `/health` –∏ `/docs`) —Ç—Ä–µ–±—É—é—Ç API –∫–ª—é—á –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
X-API-Key: –≤–∞—à_api_key
```

API –∫–ª—é—á –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `.env`.

### Swagger UI

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
```
http://localhost:3000/docs
```

### üé® –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å —Ç–µ–º–Ω–æ–π —Ç–µ–º–æ–π –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
```
http://localhost:3000/ui
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
- üìä **–î–∞—à–±–æ—Ä–¥** ‚Äî –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- üí¨ **–ß–∞—Ç—ã** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏, –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
- üìß **–°–æ–æ–±—â–µ–Ω–∏—è** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø–æ–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- üìã **–ó–∞–¥–∞—á–∏** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
- ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–∏:**
- –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —á–∞—Ç—ã –ø–æ —Å—Å—ã–ª–∫–µ –∏–ª–∏ username
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ª–∏–º–∏—Ç–∞
- –î–æ–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSON
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

---

### HTTP Endpoints

#### –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|----------|----------|------|
| `GET` | `/` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ | ‚ùå |
| `GET` | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ | ‚ùå |
| `GET` | `/docs` | Swagger UI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚ùå |

#### –°–æ–æ–±—â–µ–Ω–∏—è –∏ —á–∞—Ç—ã

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|----------|----------|------|
| `GET` | `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞—Ä—Ö–∏–≤–∞ | ‚úÖ |
| `GET` | `/chats` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ | ‚úÖ |
| `GET` | `/messages` | –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π | ‚úÖ |
| `GET` | `/search?q=...` | –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º | ‚úÖ |

#### –ó–∞–¥–∞—á–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|----------|----------|------|
| `POST` | `/load` | –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ | ‚úÖ |
| `GET` | `/task/{id}` | –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∑–∫–∏ | ‚úÖ |
| `GET` | `/queue` | –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á | ‚úÖ |
| `GET` | `/chat_status/{id}` | –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞ | ‚úÖ |
| `POST` | `/load_missed_all` | –î–æ–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö | ‚úÖ |
| `GET` | `/tasks` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á | ‚úÖ |
| `POST` | `/export` | –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ JSON | ‚úÖ |
| `POST` | `/clear_database` | –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö | ‚úÖ |
| `GET` | `/config` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é | ‚úÖ |

#### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|----------|----------|------|
| `GET` | `/ui` | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ‚ùå |
| `GET` | `/static/*` | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã UI | ‚ùå |

#### WebSocket

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|----------|----------|------|
| `WS` | `/ws` | WebSocket –¥–ª—è real-time | ‚ùå |

---

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/stats
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "total_messages": 15420,
  "total_chats": 12,
  "fully_loaded_chats": 5,
  "last_saved": "2024-02-22T10:30:00"
}
```

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/chats
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "count": 12,
  "chats": [
    {
      "chat_id": -1001234567890,
      "chat_title": "Crypto News",
      "last_message": "2024-02-22T10:25:00",
      "message_count": 5420,
      "fully_loaded": 1,
      "total_loaded": 5420
    }
  ]
}
```

#### –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

```bash
# –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  "http://localhost:3000/messages?limit=50&offset=0"

# –°–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  "http://localhost:3000/messages?chat_id=-1001234567890&limit=100"

# –° –ø–æ–∏—Å–∫–æ–º
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  "http://localhost:3000/messages?search=–±–∏—Ç–∫–æ–∏–Ω&limit=50"
```

#### –ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  "http://localhost:3000/search?q=–±–∏—Ç–∫–æ–∏–Ω&limit=100"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "query": "–±–∏—Ç–∫–æ–∏–Ω",
  "count": 42,
  "results": [
    {
      "message_id": 12345,
      "chat_id": -1001234567890,
      "chat_title": "Crypto News",
      "text": "–ë–∏—Ç–∫–æ–∏–Ω –ø—Ä–æ–±–∏–ª –Ω–æ–≤—ã–π –º–∞–∫—Å–∏–º—É–º...",
      "sender_name": "Admin",
      "message_date": "2024-02-22T09:15:00",
      "saved_at": "2024-02-22T09:15:30"
    }
  ]
}
```

#### –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
curl -X POST \
  -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  -H "Content-Type: application/json" \
  -d '{"chat_id": "@durov", "limit": 100}' \
  http://localhost:3000/load

# –í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
curl -X POST \
  -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  -H "Content-Type: application/json" \
  -d '{"chat_id": "@crypto_channel", "join": true}' \
  http://localhost:3000/load

# –î–æ–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
curl -X POST \
  -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  -H "Content-Type: application/json" \
  -d '{"chat_id": -1001234567890, "missed": true}' \
  http://localhost:3000/load
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "task_id": "a1b2c3d4",
  "status": "queued",
  "message": "–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å",
  "queue_position": 1
}
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/task/a1b2c3d4
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "a1b2c3d4",
  "type": "load_history",
  "status": "completed",
  "created_at": "2024-02-22T10:00:00",
  "started_at": "2024-02-22T10:00:01",
  "completed_at": "2024-02-22T10:05:00",
  "result": {
    "chat_id": -1001234567890,
    "chat_title": "Crypto News",
    "new_messages": 500,
    "fully_loaded": true
  }
}
```

#### –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/queue
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "size": 2,
  "processing": true,
  "requests_per_second": 1
}
```

#### –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞

```bash
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/chat_status/-1001234567890
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "chat_id": -1001234567890,
  "last_loaded_id": 12345,
  "last_message_date": "2024-02-22T10:00:00",
  "total_loaded": 5420,
  "fully_loaded": 1,
  "last_loading_date": "2024-02-22T10:00:00",
  "last_saved_message_date": "2024-02-22T10:25:00"
}
```

#### –î–æ–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤

```bash
curl -X POST \
  -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" \
  http://localhost:3000/load_missed_all
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "task_ids": ["a1b2c3d4", "e5f6g7h8"],
  "message": "–ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è 2 —á–∞—Ç–æ–≤",
  "total_chats": 2
}
```

---

## üîå WebSocket

WebSocket endpoint –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```
ws://localhost:3000/ws
```

### –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

| –¢–∏–ø —Å–æ–±—ã—Ç–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ |
|-------------|----------|--------|
| `new_message` | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ | `message` |
| `task_completed` | –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | `task` |
| `loading_progress` | –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ | `chat_id`, `loaded`, `total` |
| `chat_loaded` | –ß–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω | `chat_id`, `new_messages` |
| `missed_loaded` | –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã | `chat_id`, `count` |
| `pong` | –û—Ç–≤–µ—Ç –Ω–∞ ping | ‚Äî |

### –ü—Ä–∏–º–µ—Ä –Ω–∞ JavaScript

```javascript
const ws = new WebSocket('ws://localhost:3000/ws');

ws.onopen = () => {
  console.log('WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω');
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  ws.send(JSON.stringify({ type: 'ping' }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  switch (data.type) {
    case 'new_message':
      console.log('üì© –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', data.message);
      console.log('   –ß–∞—Ç:', data.message.chat_title);
      console.log('   –¢–µ–∫—Å—Ç:', data.message.text);
      break;
      
    case 'task_completed':
      console.log('‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:', data.task);
      break;
      
    case 'loading_progress':
      console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞:', data.loaded, '/', data.total);
      break;
      
    case 'chat_loaded':
      console.log('üìö –ß–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω:', data.chat_title);
      console.log('   –ù–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:', data.new_messages);
      break;
      
    case 'missed_loaded':
      console.log('üîç –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.count);
      break;
      
    case 'pong':
      console.log('üèì Pong –ø–æ–ª—É—á–µ–Ω');
      break;
  }
};

ws.onerror = (error) => {
  console.error('–û—à–∏–±–∫–∞ WebSocket:', error);
};

ws.onclose = () => {
  console.log('WebSocket –æ—Ç–∫–ª—é—á—ë–Ω. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
  setTimeout(() => location.reload(), 3000);
};
```

### –ü—Ä–∏–º–µ—Ä –Ω–∞ Python

```python
import asyncio
import websockets
import json

async def listen():
    uri = "ws://localhost:3000/ws"
    async with websockets.connect(uri) as websocket:
        print("WebSocket –ø–æ–¥–∫–ª—é—á—ë–Ω")
        
        while True:
            message = await websocket.recv()
            data = json.loads(message)
            
            if data['type'] == 'new_message':
                msg = data['message']
                print(f"üì© [{msg['chat_title']}] {msg['sender_name']}: {msg['text'][:50]}...")
            
            elif data['type'] == 'task_completed':
                print(f"‚úÖ –ó–∞–¥–∞—á–∞ {data['task']['id']} –∑–∞–≤–µ—Ä—à–µ–Ω–∞")

asyncio.run(listen())
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

```
data/telegrab.db
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

#### –¢–∞–±–ª–∏—Ü–∞ `messages`

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| `id` | INTEGER | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç ID |
| `message_id` | INTEGER | ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| `chat_id` | INTEGER | ID —á–∞—Ç–∞ |
| `chat_title` | TEXT | –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞ |
| `text` | TEXT | –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `sender_name` | TEXT | –ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è |
| `message_date` | TEXT | –î–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (ISO 8601) |
| `saved_at` | TIMESTAMP | –ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (–∞–≤—Ç–æ) |

#### –¢–∞–±–ª–∏—Ü–∞ `chat_loading_status`

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| `chat_id` | INTEGER | ID —á–∞—Ç–∞ (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á) |
| `last_loaded_id` | INTEGER | ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `last_message_date` | TEXT | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `total_loaded` | INTEGER | –í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π |
| `fully_loaded` | BOOLEAN | –ü–æ–ª–Ω–æ—Å—Ç—å—é –ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω —á–∞—Ç |
| `last_loading_date` | TEXT | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ |
| `created_at` | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ |

### –ò–Ω–¥–µ–∫—Å—ã

```sql
CREATE INDEX idx_chat ON messages(chat_id);
CREATE INDEX idx_date ON messages(message_date);
CREATE INDEX idx_saved_at ON messages(saved_at);
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
cp data/telegrab.db data/telegrab.backup.$(date +%Y%m%d).db

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
cp data/telegrab.backup.20240222.db data/telegrab.db
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### API –∫–ª—é—á–∏

- API –∫–ª—é—á –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `.env`
- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ git!** (—Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`)

### –°–º–µ–Ω–∞ API –∫–ª—é—á–∞

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á
NEW_KEY="tg_$(openssl rand -hex 16)"
sed -i "s/^API_KEY=.*/API_KEY=$NEW_KEY/" .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose restart telegrab
```

### HTTPS (nginx)

–î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx —Å SSL:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d your-domain.com

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è Docker
mkdir -p ssl
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ssl/
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ssl/

# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ nginx –≤ docker-compose.yml
nano docker-compose.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose up -d nginx
```

### Firewall

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UFW
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 443/tcp   # HTTPS (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ nginx)
sudo ufw deny 3000/tcp   # –ó–∞–∫—Ä—ã—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ API
sudo ufw enable

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo ufw status
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ fail2ban
sudo apt install -y fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ root login
sudo nano /etc/ssh/sshd_config
# PermitRootLogin no
# PasswordAuthentication no

sudo systemctl restart sshd
```

---

## üè≠ Production —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

| –†–µ—Å—É—Ä—Å | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|--------|------------|
| CPU | 1 —è–¥—Ä–æ |
| RAM | 512 MB |
| Disk | 5 GB |
| OS | Ubuntu 22.04 LTS |

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –†–µ—Å—É—Ä—Å | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|--------|------------|
| CPU | 2 —è–¥—Ä–∞ |
| RAM | 1 GB |
| Disk | 20 GB SSD |
| OS | Ubuntu 22.04 LTS |

### –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

#### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo apt install -y docker-compose

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ Docker
sudo systemctl enable docker
sudo systemctl start docker
```

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Telegrab

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /opt/telegrab
sudo chown $USER:$USER /opt/telegrab
cd /opt/telegrab

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone https://github.com/JeBance/telegrab.git .

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞
cp .env.example .env
nano .env  # —É–∫–∞–∂–∏—Ç–µ API_ID, API_HASH, PHONE
```

#### 3. –ó–∞–ø—É—Å–∫

```bash
# –°—Ç–∞—Ä—Ç
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker-compose ps
docker-compose logs -f
```

#### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ SSL –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir ssl

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo apt install -y certbot
sudo certbot certonly --standalone -d your-domain.com

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
sudo cp /etc/letsencrypt/live/your-domain.com/fullchain.pem ssl/
sudo cp /etc/letsencrypt/live/your-domain.com/privkey.pem ssl/

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ docker-compose.yml (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å nginx)
nano docker-compose.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose up -d
```

#### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cat > /usr/local/bin/telegrab-check.sh << 'EOF'
#!/bin/bash
if ! docker-compose ps | grep -q "Up"; then
    echo "Telegrab –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫..."
    cd /opt/telegrab
    docker-compose restart
    echo "Telegrab –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω" | mail -s "Telegrab Alert" admin@example.com
fi
EOF

chmod +x /usr/local/bin/telegrab-check.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab
echo "*/5 * * * * /usr/local/bin/telegrab-check.sh" | crontab -
```

---

## üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

Telegrab –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ GitHub –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

### –°–ø–æ—Å–æ–± 1: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (systemd timer)

–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –≤ 3:00 –Ω–æ—á–∏:

```bash
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã
sudo mkdir -p /opt/telegrab/scripts
sudo cp scripts/*.sh /opt/telegrab/scripts/
sudo cp scripts/*.service /opt/telegrab/scripts/
sudo cp scripts/*.timer /opt/telegrab/scripts/
sudo chmod +x /opt/telegrab/scripts/*.sh

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ systemd unit —Ñ–∞–π–ª—ã
sudo cp /opt/telegrab/scripts/telegrab-update.service /etc/systemd/system/
sudo cp /opt/telegrab/scripts/telegrab-update.timer /etc/systemd/system/
sudo systemctl daemon-reload

# 3. –í–∫–ª—é—á–∏—Ç–µ —Ç–∞–π–º–µ—Ä
sudo systemctl enable telegrab-update.timer
sudo systemctl start telegrab-update.timer

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl list-timers | grep telegrab
```

### –°–ø–æ—Å–æ–± 2: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (GitHub webhook)

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ GitHub:**
1. Settings ‚Üí Webhooks ‚Üí Add webhook
2. Payload URL: `http://your-server-ip:8080`
3. Secret: –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–æ–∫—É
4. Events: Just the push event

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ webhook-server.sh
sudo nano /opt/telegrab/scripts/webhook-server.sh
# –£–∫–∞–∂–∏—Ç–µ SECRET="–≤–∞—à_—Å–µ–∫—Ä–µ—Ç_–∏–∑_github"

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo cp /opt/telegrab/scripts/telegrab-webhook.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable telegrab-webhook.service
sudo systemctl start telegrab-webhook.service
```

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
sudo /opt/telegrab/scripts/auto-update.sh
```

### –õ–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```bash
journalctl -u telegrab-update.service -f
```

üìö **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [scripts/README.md](scripts/README.md)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### Docker Compose –ª–æ–≥–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f telegrab

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 telegrab

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
docker-compose logs --since=24h telegrab
```

### systemd –ª–æ–≥–∏ (–ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑ install.sh)

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
journalctl -u telegrab -f

# –õ–æ–≥–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
journalctl -u telegrab --since today

# –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
journalctl -u telegrab | grep "–æ—à–∏–±–∫–∞"
```

### Health check

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
curl http://localhost:3000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å API –∫–ª—é—á–æ–º
curl -H "X-API-Key: –≤–∞—à_–∫–ª—é—á" http://localhost:3000/stats
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|----------|
| –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ | `/health` | –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π | `/stats` | total_messages |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Ç–æ–≤ | `/stats` | total_chats |
| –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á | `/queue` | size, processing |

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

#### 1. "API_ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª `.env` –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cp .env.example .env
nano .env  # —É–∫–∞–∂–∏—Ç–µ API_ID, API_HASH, PHONE
docker-compose restart telegrab
```

#### 2. "Telethon –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install -r requirements.txt
# –∏–ª–∏
docker-compose build telegrab
docker-compose up -d telegrab
```

#### 3. "–ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Telegram"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –£–≤–µ–ª–∏—á—å—Ç–µ `connection_retries` –≤ –∫–æ–¥–µ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏

#### 4. "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ Telegram"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è rate limiting.

**–†–µ—à–µ–Ω–∏–µ:**
```ini
# –£–º–µ–Ω—å—à–∏—Ç–µ –≤ .env
REQUESTS_PER_SECOND=0.5
MESSAGES_PER_REQUEST=50
```

#### 5. "API –∫–ª—é—á –Ω–µ–≤–µ—Ä–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–ª—é—á –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –≤ .env
cat .env | grep API_KEY

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
curl -H "X-API-Key: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π_–∫–ª—é—á" ...
```

#### 6. "Port 3000 already in use"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
sudo lsof -i :3000

# –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –≤ .env
API_PORT=3001

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart telegrab
```

#### 7. "Session expired" –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Å—Å–∏—è Telegram —É—Å—Ç–∞—Ä–µ–ª–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é —Å–µ—Å—Å–∏—é
rm .session

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –≤–≤–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ SMS
docker-compose restart telegrab
docker-compose logs -f telegrab
```

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
docker-compose logs -f telegrab 2>&1 | tee telegrab.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose exec telegrab python -c "from api import CONFIG; print(CONFIG)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec telegrab sqlite3 data/telegrab.db "SELECT COUNT(*) FROM messages;"
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegrab/
‚îú‚îÄ‚îÄ telegrab.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ api.py                   # FastAPI —Å–µ—Ä–≤–µ—Ä, WebSocket, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example            # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .env                    # –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îú‚îÄ‚îÄ .session                # –°–µ—Å—Å–∏—è Telegram (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îú‚îÄ‚îÄ .gitignore              # Git ignore –ø—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ .dockerignore           # Docker ignore –ø—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ telegrab.service        # systemd —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ nginx.conf              # nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ install.sh              # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ telegrab.db         # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

---

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è –ª—é–±—ã–µ –≤–∫–ª–∞–¥—ã –≤ –ø—Ä–æ–µ–∫—Ç!

### –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –≤–∫–ª–∞–¥

1. **Fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
   ```bash
   git checkout -b feature/amazing-feature
   ```
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ:
   ```bash
   git commit -m "feat: –¥–æ–±–∞–≤–∏—Ç—å amazing feature"
   ```
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git push origin feature/amazing-feature
   ```
5. –°–æ–∑–¥–∞–π—Ç–µ **Pull Request**

### –°–æ–≥–ª–∞—à–µ–Ω–∏—è –ø–æ –∫–æ–º–º–∏—Ç–∞–º

- `feat:` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
- `fix:` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
- `docs:` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `style:` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `refactor:` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- `test:` ‚Äî —Ç–µ—Å—Ç—ã
- `chore:` ‚Äî –ø—Ä–æ—á–µ–µ

### –ë–∞–≥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

- üêõ **–ù–∞—à–ª–∏ –±–∞–≥?** –°–æ–∑–¥–∞–π—Ç–µ [Issue](https://github.com/JeBance/telegrab/issues)
- üí° **–ï—Å—Ç—å –∏–¥–µ—è?** –°–æ–∑–¥–∞–π—Ç–µ [Discussion](https://github.com/JeBance/telegrab/discussions)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT License**.

–°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **GitHub:** [@JeBance](https://github.com/JeBance)
- **Issues:** [–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ](https://github.com/JeBance/telegrab/issues)
- **Discussions:** [–û–±—Å—É–∂–¥–µ–Ω–∏–µ](https://github.com/JeBance/telegrab/discussions)

---

## ‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–ª–µ–∑–Ω—ã–º ‚Äî –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É –Ω–∞ GitHub! ‚≠ê

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–µ–∫—Ç—É —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –∏ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

---

## üìù Changelog

### v4.0 (2024)
- ‚ú® –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ FastAPI + Uvicorn
- üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ API –∫–ª—é—á–∏
- üîå WebSocket –¥–ª—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- üê≥ Docker –∏ Docker Compose –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚öôÔ∏è systemd —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
- üåê nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è HTTPS
- üìö –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### v3.2 (2023)
- üîç –£–º–Ω–∞—è –¥–æ–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚ö° –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á —Å rate limiting

### v3.0 (2023)
- üåê REST API
- üìö –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤
- ü§ñ UserBot —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã

---

<div align="center">

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è Telegram**

[–ù–∞–≤–µ—Ä—Ö](#-telegrab---–∞—Ä—Ö–∏–≤–∞—Ç–æ—Ä-—Å–æ–æ–±—â–µ–Ω–∏–π-telegram)

</div>
