<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegrab - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Fallback styles if JS fails -->
    <noscript>
        <style>
            body { background: #1c252e; color: #e4e6eb; font-family: system-ui, sans-serif; padding: 20px; }
            .card { background: #242f3d; padding: 20px; margin: 20px; border-radius: 12px; }
        </style>
    </noscript>
    
    <style>
        :root {
            --tg-blue: #2AABEE;
            --tg-dark: #1c252e;
            --tg-card: #242f3d;
        }
        body {
            background: linear-gradient(135deg, #1c252e 0%, #0d1117 100%);
            min-height: 100vh;
            color: #e4e6eb;
        }
        .navbar {
            background: rgba(36, 47, 61, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .navbar-brand {
            color: var(--tg-blue) !important;
            font-weight: 700;
        }
        .card {
            background: var(--tg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: #e4e6eb;
        }
        .card-header {
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-weight: 600;
            color: #e4e6eb;
        }
        .card-body {
            color: #e4e6eb;
        }
        .card-title {
            color: #e4e6eb;
        }
        .stat-card {
            transition: transform 0.2s;
        }
        .stat-card h6 {
            color: #8b949e !important;
        }
        .stat-card h3 {
            color: #e4e6eb !important;
        }
        /* Quick stats –≤ sidebar */
        #quickStats span:first-child {
            color: #8b949e !important;
        }
        #quickStats strong {
            color: #e4e6eb !important;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        .btn-tg {
            background: var(--tg-blue);
            color: white;
            border: none;
        }
        .btn-tg:hover {
            background: #229ED9;
            color: white;
        }
        .table {
            color: #e4e6eb;
        }
        .table-dark {
            --bs-table-bg: transparent;
        }
        .table td, .table th {
            color: #e4e6eb !important;
            font-size: 0.875rem !important;
            vertical-align: top !important;
            background-color: transparent !important;
        }
        .table td small, .table th small {
            color: #a0aec0 !important;
            font-size: 0.75rem !important;
        }
        /* –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ–±—â–µ–Ω–∏–π - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—Ç–∏–ª—å */
        #messagesTable td:nth-child(2) {
            white-space: normal !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
            max-width: 600px !important;
            line-height: 1.4 !important;
        }
        #messagesTable td {
            padding: 8px 12px !important;
        }
        /* –¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–æ–≤ - —Å—Ç–∏–ª–∏ */
        #chatsTable td, #chatsTable th {
            color: #e4e6eb !important;
            background-color: rgba(36, 47, 61, 0.5) !important;
        }
        #chatsTable td strong {
            color: #ffffff !important;
        }
        #chatsTable td small {
            color: #8b949e !important;
        }
        /* –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —á–∞—Ç—ã) */
        .table-success, .table-success td, .table-success th {
            background: rgba(42, 171, 238, 0.2) !important;
            color: #e4e6eb !important;
        }
        .table-success td strong, .table-success th strong {
            color: #ffffff !important;
        }
        .table-success td small, .table-success th small {
            color: #8b949e !important;
        }
        .table-success .badge {
            color: #fff !important;
        }
        .text-muted {
            color: #8b949e !important;
        }
        /* –¢–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ö */
        .form-label {
            color: #e4e6eb !important;
        }
        /* –¢–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
        .form-text, small.text-muted {
            color: #8b949e !important;
        }
        .form-control, .form-select {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #e4e6eb;
        }
        .form-control:focus, .form-select:focus {
            background: rgba(255,255,255,0.1);
            border-color: var(--tg-blue);
            color: #e4e6eb;
            box-shadow: 0 0 0 0.25rem rgba(42, 171, 238, 0.25);
        }
        .badge-chat {
            background: rgba(42, 171, 238, 0.2);
            color: var(--tg-blue);
        }
        .progress {
            background: rgba(255,255,255,0.1);
        }
        .log-terminal {
            background: #0d1117;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 3px 0;
        }
        .log-info { color: #58a6ff; }
        .log-success { color: #3fb950; }
        .log-warning { color: #d29922; }
        .log-error { color: #f85149; }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background: #3fb950; box-shadow: 0 0 10px #3fb950; }
        .status-offline { background: #f85149; }
        .modal-content {
            background: var(--tg-card);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .modal-footer {
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
            border-width: 0.15em;
        }
        .chat-item {
            cursor: pointer;
            transition: background 0.2s;
        }
        .chat-item:hover {
            background: rgba(255,255,255,0.05);
        }
        .nav-pills .nav-link {
            color: #8b949e;
        }
        .nav-pills .nav-link.active {
            background: var(--tg-blue);
            color: white;
        }
        .nav-pills .nav-link:hover {
            color: #e4e6eb;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-telegram"></i> Telegrab
            </a>
            <div class="d-flex align-items-center">
                <span class="me-3">
                    <span class="status-dot" id="connectionStatus"></span>
                    <span id="connectionText">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                </span>
                <button class="btn btn-sm btn-outline-light" onclick="refreshAll()">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Loading indicator -->
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1c252e; z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <h4 class="text-light">Telegrab –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</h4>
            <p class="text-muted" id="loadingStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authScreen" class="container-fluid py-5" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-5">
                <div class="card">
                    <div class="card-body p-4">
                        <h4 class="mb-3 text-center"><i class="bi bi-telegram"></i> Telegrab</h4>
                        <p class="text-muted text-center mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram</p>
                        
                        <div id="authStatus" class="mb-4"></div>
                        
                        <!-- –§–æ—Ä–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram -->
                        <form id="telegramConfigForm">
                            <h6 class="mb-3"><i class="bi bi-key"></i> –î–∞–Ω–Ω—ã–µ Telegram API</h6>
                            <p class="small text-muted">
                                –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏ –Ω–∞ <a href="https://my.telegram.org" target="_blank">my.telegram.org</a>
                            </p>
                            
                            <div class="mb-3">
                                <label class="form-label">API ID <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="authApiId" required placeholder="12345678">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">API Hash <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="authApiHash" required placeholder="abcdef1234567890abcdef1234567890">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="authPhone" required placeholder="+79991234567">
                            </div>
                            
                            <button type="submit" class="btn btn-tg w-100 mb-3">
                                <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                            </button>
                        </form>
                        
                        <hr class="my-4">
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ QR –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
                        <div id="qrAuthSection" style="display: none;">
                            <button class="btn btn-tg w-100 btn-lg" onclick="showQrAuth()">
                                <i class="bi bi-qr-code"></i> –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–æ QR-–∫–æ–¥—É
                            </button>
                            
                            <p class="small text-muted mt-3 text-center">
                                –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º Telegram:<br>
                                <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ‚Üí –ü–æ–¥–∫–ª—é—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4" id="mainInterface" style="display: none;">
        <div class="row g-4">
            <!-- Sidebar -->
            <div class="col-lg-2">
                <div class="card">
                    <div class="card-body p-2">
                        <div class="nav flex-column nav-pills" role="tablist">
                            <button class="nav-link active text-start" data-bs-toggle="pill" data-bs-target="#dashboard">
                                <i class="bi bi-speedometer2 me-2"></i> –û–±–∑–æ—Ä
                            </button>
                            <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#messages">
                                <i class="bi bi-envelope me-2"></i> –°–æ–æ–±—â–µ–Ω–∏—è
                            </button>
                            <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#tasks">
                                <i class="bi bi-list-task me-2"></i> –ó–∞–¥–∞—á–∏
                            </button>
                            <button class="nav-link text-start" onclick="showAdvancedSearch()">
                                <i class="bi bi-search me-2"></i> –ü–æ–∏—Å–∫
                            </button>
                            <button class="nav-link text-start" onclick="showMediaGallery()">
                                <i class="bi bi-images me-2"></i> –ì–∞–ª–µ—Ä–µ—è
                            </button>
                            <button class="nav-link text-start" onclick="showFilesStats()">
                                <i class="bi bi-file-earmark-bar-graph me-2"></i> –§–∞–π–ª—ã
                            </button>
                            <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#settings">
                                <i class="bi bi-gear me-2"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-10">
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard">

                        <!-- Recent Activity -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="bi bi-activity"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                            </div>
                            <div class="card-body">
                                <div class="log-terminal" id="activityLog">
                                    <div class="log-entry log-info">üöÄ Telegrab –∑–∞–ø—É—â–µ–Ω...</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ß–∞—Ç—ã Telegram -->
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="bi bi-chat-left-text"></i> –ß–∞—Ç—ã Telegram</h5>
                                    <button class="btn btn-sm btn-tg" onclick="loadChats()">
                                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                                <div class="row g-3 mb-4">
                                    <div class="col-md-12">
                                        <div class="d-flex gap-3 flex-wrap">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="filterChannels" checked onchange="applyChatFilters()">
                                                <label class="form-check-label" for="filterChannels">
                                                    <i class="bi bi-megaphone text-info"></i> –ö–∞–Ω–∞–ª—ã
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="filterGroups" checked onchange="applyChatFilters()">
                                                <label class="form-check-label" for="filterGroups">
                                                    <i class="bi bi-people text-success"></i> –ì—Ä—É–ø–ø—ã
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="filterPrivate" checked onchange="applyChatFilters()">
                                                <label class="form-check-label" for="filterPrivate">
                                                    <i class="bi bi-person text-secondary"></i> –õ–∏—á–Ω—ã–µ
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="filterLoaded" onchange="applyChatFilters()">
                                                <label class="form-check-label" for="filterLoaded">
                                                    <i class="bi bi-check-circle text-warning"></i> –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                                            <input type="text" class="form-control" id="chatSearchInput" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..." onkeyup="applyChatFilters()">
                                        </div>
                                    </div>
                                </div>

                                <!-- –¢–∞–±–ª–∏—Ü–∞ —á–∞—Ç–æ–≤ -->
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover">
                                        <thead>
                                            <tr>
                                                <th style="width: 40%">–ß–∞—Ç</th>
                                                <th style="width: 10%">–¢–∏–ø</th>
                                                <th style="width: 15%">–°–æ–æ–±—â–µ–Ω–∏–π</th>
                                                <th style="width: 20%">–ü–æ—Å–ª–µ–¥–Ω–µ–µ</th>
                                                <th style="width: 15%">–î–µ–π—Å—Ç–≤–∏—è</th>
                                            </tr>
                                        </thead>
                                        <tbody id="chatsTable">
                                            <tr><td colspan="5" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                <div class="text-muted small mt-3">
                                    <span id="chatsCount">0 —á–∞—Ç–æ–≤</span>
                                    <span class="mx-2">|</span>
                                    <span id="loadedCount">0 –∑–∞–≥—Ä—É–∂–µ–Ω–æ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Tab -->
                    <div class="tab-pane fade" id="messages">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-envelope"></i> –°–æ–æ–±—â–µ–Ω–∏—è</span>
                                <div class="d-flex gap-2">
                                    <select class="form-select form-select-sm" id="messageChatFilter" onchange="loadMessages()">
                                        <option value="">–í—Å–µ —á–∞—Ç—ã</option>
                                    </select>
                                    <input type="text" class="form-control form-control-sm" id="messageSearch" placeholder="–ü–æ–∏—Å–∫..." onkeyup="loadMessages()">
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>–ß–∞—Ç</th>
                                                <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                                                <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                                                <th>–î–∞—Ç–∞</th>
                                            </tr>
                                        </thead>
                                        <tbody id="messagesTable">
                                            <tr><td colspan="4" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="p-3 d-flex justify-content-between align-items-center">
                                    <span class="text-muted" id="messagesCount">0 —Å–æ–æ–±—â–µ–Ω–∏–π</span>
                                    <nav>
                                        <ul class="pagination pagination-sm mb-0" id="messagesPagination"></ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tasks Tab -->
                    <div class="tab-pane fade" id="tasks">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-list-task"></i> –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-3">
                                    <div>
                                        <span class="me-3">–°—Ç–∞—Ç—É—Å: <strong id="taskProcessingStatus">–û–∂–∏–¥–∞–Ω–∏–µ</strong></span>
                                        <span>–í –æ—á–µ—Ä–µ–¥–∏: <strong id="taskQueueSize">0</strong></span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-light" onclick="refreshQueue()">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                                <div id="tasksList">
                                    <div class="text-center text-muted py-5">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane fade" id="settings">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span><i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                                <div id="telegramStatus">
                                    <span class="badge bg-warning">‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <form id="settingsForm">
                                    <h6 class="mb-3"><i class="bi bi-telegram"></i> Telegram API</h6>
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-4">
                                            <label class="form-label">API ID</label>
                                            <input type="text" class="form-control" id="settingApiId" placeholder="12345678">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">API Hash</label>
                                            <input type="text" class="form-control" id="settingApiHash" placeholder="abcdef1234567890...">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Phone</label>
                                            <input type="text" class="form-control" id="settingPhone" placeholder="+79991234567">
                                        </div>
                                    </div>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle"></i> –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏ –Ω–∞ <a href="https://my.telegram.org" target="_blank">my.telegram.org</a>
                                    </div>

                                    <h6 class="mb-3"><i class="bi bi-key"></i> –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h6>
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-6">
                                            <label class="form-label">API Key</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="settingApiKey" readonly>
                                                <button class="btn btn-outline-light" type="button" onclick="copyApiKey()">
                                                    <i class="bi bi-clipboard"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <h6 class="mb-3"><i class="bi bi-sliders"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏</h6>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle"></i> 
                                        <strong>–õ–∏–º–∏—Ç—ã Telegram API:</strong>
                                        <ul class="mb-0 mt-2 small">
                                            <li>–ú–∞–∫—Å–∏–º—É–º 500 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 100)</li>
                                            <li>–ú–∞–∫—Å–∏–º—É–º 30-50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1-2 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)</li>
                                            <li>–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ –≤–æ–∑–º–æ–∂–Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (FLOOD_WAIT)</li>
                                            <li>–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç: ~100,000 —Å–æ–æ–±—â–µ–Ω–∏–π</li>
                                        </ul>
                                    </div>
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-3">
                                            <label class="form-label">–ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É</label>
                                            <input type="number" class="form-control" id="settingRequestsPerSecond" value="1" min="1" max="10">
                                            <small class="text-muted">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1-2</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">–°–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –∑–∞–ø—Ä–æ—Å</label>
                                            <input type="number" class="form-control" id="settingMessagesPerRequest" value="100" min="1" max="500">
                                            <small class="text-muted">–ú–∞–∫—Å–∏–º—É–º: 500</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">–õ–∏–º–∏—Ç –∏—Å—Ç–æ—Ä–∏–∏</label>
                                            <input type="number" class="form-control" id="settingHistoryLimit" value="200" min="0" placeholder="0 = –±–µ–∑ –ª–∏–º–∏—Ç–∞">
                                            <small class="text-muted">0 = –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è</small>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">–ú–∞–∫—Å. —á–∞—Ç–æ–≤</label>
                                            <input type="number" class="form-control" id="settingMaxChats" value="20">
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-tg">
                                            <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
                                        </button>
                                        <button type="button" class="btn btn-outline-light" onclick="restartTelegram()">
                                            <i class="bi bi-arrow-clockwise"></i> –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Telegram
                                        </button>
                                        <button type="button" class="btn btn-outline-info" onclick="checkTelegramStatus()">
                                            <i class="bi bi-activity"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                                        </button>
                                    </div>
                                    <div id="restartStatus" class="mt-3"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Join Chat Modal -->
    <div class="modal fade" id="joinChatModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-person-plus"></i> –í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–°—Å—ã–ª–∫–∞ –∏–ª–∏ username —á–∞—Ç–∞</label>
                        <input type="text" class="form-control" id="joinChatInput" placeholder="@username –∏–ª–∏ https://t.me/...">
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="joinAndLoad" checked>
                        <label class="form-check-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-tg" onclick="joinChat()">–í—Å—Ç—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load History Modal -->
    <div class="modal fade" id="loadHistoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-download"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π</label>
                        <input type="number" class="form-control" id="loadHistoryLimit" placeholder="0 = –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ">
                    </div>
                    <input type="hidden" id="loadHistoryChatId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-tg" onclick="confirmLoadHistory()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Authorization Modal -->
    <div class="modal fade" id="qrAuthModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-qr-code"></i> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Telegram</h5>
                </div>
                <div class="modal-body text-center">
                    <div id="qrAuthContent">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ QR-–∫–æ–¥–∞...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" onclick="checkQrStatus()">
                        <i class="bi bi-arrow-clockwise"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    </button>
                    <button type="button" class="btn btn-tg" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================ -->
    <!-- –ù–û–í–´–ï –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –î–õ–Ø –ë–î V6 -->
    <!-- ============================================================ -->

    <!-- RAW –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="modal fade" id="messageRawModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-code-slash"></i> RAW –¥–∞–Ω–Ω—ã–µ</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 id="rawMessageId" class="mb-3"></h6>
                    <pre id="rawDataContent" class="bg-dark text-light p-3 rounded" style="max-height: 500px; overflow-y: auto;"></pre>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" onclick="copyRawData()">
                        <i class="bi bi-clipboard"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button type="button" class="btn btn-tg" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–π -->
    <div class="modal fade" id="messageEditsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil-square"></i> –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–π</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 id="editsMessageId" class="mb-2"></h6>
                    <small class="text-muted">–ó–∞–ø–∏—Å–µ–π: <span id="editsCount">0</span></small>
                    <div class="table-responsive mt-3">
                        <table class="table table-dark table-sm">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç</th>
                                    <th>–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç</th>
                                </tr>
                            </thead>
                            <tbody id="editsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–æ–±—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div class="modal fade" id="messageEventsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-activity"></i> –°–æ–±—ã—Ç–∏—è</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-sm">
                            <thead>
                                <tr>
                                    <th>–¢–∏–ø</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
    <div class="modal fade" id="filesStatsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-file-earmark-bar-graph"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h6 class="text-muted">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</h6>
                                    <h3 id="filesTotalCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h6 class="text-muted">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä</h6>
                                    <h3 id="filesTotalSize">0 B</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <h6 class="text-muted">–¢–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤</h6>
                                    <h3 id="filesTypesCount">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-tg" onclick="showFilesList()">
                        <i class="bi bi-list"></i> –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª—ã
                    </button>
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
    <div class="modal fade" id="filesListModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-folder"></i> –§–∞–π–ª—ã</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-5">
                            <select class="form-select form-select-sm" id="filesChatFilter" onchange="loadFilesList()">
                                <option value="">–í—Å–µ —á–∞—Ç—ã</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select form-select-sm" id="filesMediaType" onchange="loadFilesList()">
                                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="photo">–§–æ—Ç–æ</option>
                                <option value="video">–í–∏–¥–µ–æ</option>
                                <option value="document">–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
                                <option value="audio">–ê—É–¥–∏–æ</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-outline-light w-100" onclick="loadFilesList()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                    <small class="text-muted">–í—Å–µ–≥–æ: <span id="filesListCount">0</span></small>
                    <div class="table-responsive mt-3">
                        <table class="table table-dark table-sm">
                            <thead>
                                <tr>
                                    <th>–ß–∞—Ç</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="filesListBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞ -->
    <div class="modal fade" id="chatStatsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-bar-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 id="chatStatsTitle" class="mb-3"></h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="card bg-dark text-center">
                                <div class="card-body">
                                    <small class="text-muted">–°–æ–æ–±—â–µ–Ω–∏–π</small>
                                    <h4 id="chatStatsTotalMessages">0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-dark text-center">
                                <div class="card-body">
                                    <small class="text-muted">–ê–≤—Ç–æ—Ä–æ–≤</small>
                                    <h4 id="chatStatsUniqueSenders">0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-dark text-center">
                                <div class="card-body">
                                    <small class="text-muted">–° –º–µ–¥–∏–∞</small>
                                    <h4 id="chatStatsWithMedia">0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-dark text-center">
                                <div class="card-body">
                                    <small class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</small>
                                    <h4 id="chatStatsTotalViews">0</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-dark text-center">
                                <div class="card-body">
                                    <small class="text-muted">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å</small>
                                    <h4 id="chatStatsEditedMessages">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <strong>–¢–∏–ø—ã –º–µ–¥–∏–∞:</strong>
                        <div id="chatStatsMediaTypes" class="mt-2"></div>
                    </div>
                    <div>
                        <strong>–°–æ–±—ã—Ç–∏—è:</strong>
                        <div id="chatStatsEvents" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ -->
    <div class="modal fade" id="advancedSearchModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-search"></i> –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</label>
                        <input type="text" class="form-control" id="searchQuery" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ß–∞—Ç ID</label>
                        <input type="text" class="form-control" id="searchChatId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: -1001234567890">
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="searchHasMedia">
                        <label class="form-check-label">–¢–æ–ª—å–∫–æ —Å –º–µ–¥–∏–∞</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø –º–µ–¥–∏–∞</label>
                        <select class="form-select" id="searchMediaType">
                            <option value="">–õ—é–±–æ–π</option>
                            <option value="photo">–§–æ—Ç–æ</option>
                            <option value="video">–í–∏–¥–µ–æ</option>
                            <option value="document">–î–æ–∫—É–º–µ–Ω—Ç</option>
                            <option value="audio">–ê—É–¥–∏–æ</option>
                            <option value="voice">–ì–æ–ª–æ—Å–æ–≤–æ–µ</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –æ—Ç</label>
                            <input type="date" class="form-control" id="searchDateFrom">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –¥–æ</label>
                            <input type="date" class="form-control" id="searchDateTo">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–õ–∏–º–∏—Ç</label>
                        <input type="number" class="form-control" id="searchLimit" value="100" max="1000">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-tg" onclick="performAdvancedSearch()">
                        <i class="bi bi-search"></i> –ü–æ–∏—Å–∫
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ì–∞–ª–µ—Ä–µ—è –º–µ–¥–∏–∞ -->
    <div class="modal fade" id="mediaGalleryModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-images"></i> –ì–∞–ª–µ—Ä–µ—è –º–µ–¥–∏–∞</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="row g-2 mb-3">
                        <div class="col-md-4">
                            <select class="form-select form-select-sm" id="galleryChatFilter" onchange="loadMediaGallery()">
                                <option value="">–í—Å–µ —á–∞—Ç—ã</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-select-sm" id="galleryMediaType" onchange="loadMediaGallery()">
                                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="photo">–§–æ—Ç–æ</option>
                                <option value="video">–í–∏–¥–µ–æ</option>
                                <option value="document">–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
                                <option value="audio">–ê—É–¥–∏–æ</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <span class="badge bg-info" id="galleryPhotoCount">–§–æ—Ç–æ: 0</span>
                        </div>
                        <div class="col-md-2">
                            <span class="badge bg-danger" id="galleryVideoCount">–í–∏–¥–µ–æ: 0</span>
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-sm btn-outline-light" onclick="loadMediaGallery()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                    <div id="mediaGalleryContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
